{"version":3,"file":"y-webrtc.node.js","sources":["src/y-webrtc.js"],"sourcesContent":["import io from 'socket.io-client'\n\nexport default function extend(Y) {\n    class Connector extends Y.AbstractConnector {\n        constructor(y, options) {\n            if (options === undefined) {\n                throw new Error('Options must not be undefined!')\n            }\n            options.preferUntransformed = true\n            options.generateUserId = options.generateUserId || false\n            if (options.initSync !== false) {\n                options.initSync = true\n            }\n            super(y, options)\n            this._sentSync = false\n            this.options = options\n            options.url = options.url || 'https://yjs.dbis.rwth-aachen.de:5072'\n            var socket = options.socket || io(options.url, options.options)\n            this.socket = socket\n            var self = this\n\n            /****************** start minimal webrtc **********************/\n            var signaling_socket = socket;\n            var ICE_SERVERS = [\n                {urls: \"stun:stun.l.google.com:19302\"},\n                {urls: \"turn:try.refactored.ai:3478\", username: \"test99\", credential: \"test\"}\n            ];\n            var dcs = {};\n            var sdcs = {};\n            this.dcs = dcs;\n            this.sdcs = dcs;\n            //dcs2: user datachannel\n            this.dcs2 = {};\n            var local_media_stream = null;\n            var peers = {};\n            var peer_media_elements = {};\n            var sockets;\n            this.sockets = sockets;\n            this.markers = {};\n\n\t        function receiveData(ywebrtc, peer_id) {\n\t            var buf, count;\n\t            return function onmessage(event) {\n\t                if (typeof event.data === 'string') {\n\t                    buf = new Uint8Array(parseInt(event.data));\n\t                    count = 0;\n\t                    return;\n\t                }\n\t                var data = new Uint8Array(event.data);\n\t                buf.set(data, count);\n\t                count += data.byteLength;\n\t                if (count === buf.byteLength) {\n\t                    ywebrtc.receiveMessage(peer_id, buf);\n\t                }\n\t            };\n\t        }\n\n            function get_cell(id) {\n                var cells = Jupyter.notebook.get_cells();\n                for (var i = 0; i < cells.length; i++) {\n                    if (cells[i].id === id) {\n                        return cells[i];\n                    }\n                }\n            }\n\n            function receiveData2(ywebrtc, peer_id) {\n                return function onmessage(event) {\n                    var data = JSON.parse(event.data);\n                    var cm = get_cell(data.id).code_mirror;\n                    var cursorCoords = cm.cursorCoords(data);\n                    var cursorElement = document.createElement('span');\n                    cursorElement.style.borderLeftStyle = 'solid';\n                    cursorElement.style.borderLeftWidth = '2px';\n                    cursorElement.style.borderLeftColor = data.color;\n                    cursorElement.style.height = cursorCoords.bottom - cursorCoords.top + 'px';\n                    cursorElement.style.padding = 0;\n                    cursorElement.style.zIndex = 0;\n                    var id = peer_id + data.id;\n                    if (ywebrtc.markers[id]) {\n                        ywebrtc.markers[id].clear();\n                    }\n                    ywebrtc.markers[id] = cm.setBookmark(data, { widget: cursorElement });\n                };\n            }\n\n            function init(ywebrtc) {\n                signaling_socket.on('connect', function() {\n                    join_chat_channel(ywebrtc.options.room, {'whatever-you-want-here': 'stuff'});\n                });\n            \n                signaling_socket.on('sockets', function (sockets) {\n                    window.sockets = sockets;\n                });\n            \n                signaling_socket.on('disconnect', function() {\n                    /* Tear down all of our peer connections and remove all the\n                     * media divs when we disconnect */\n                    for (peer_id in peer_media_elements) {\n                        peer_media_elements[peer_id].remove();\n                    }\n                    for (peer_id in peers) {\n                        peers[peer_id].close();\n                    }\n            \n                    peers = {};\n                    peer_media_elements = {};\n                });\n\n                function join_chat_channel(channel, userdata) {\n                    signaling_socket.emit('join', {\"channel\": channel, \"userdata\": userdata});\n                    ywebrtc.userID = signaling_socket.id;\n                }\n\n                function part_chat_channel(channel) {\n                    signaling_socket.emit('part', channel);\n                }\n            \n            \n                signaling_socket.on('addPeer', function(config) {\n                    var peer_id = config.peer_id;\n            \n                    if (peer_id in peers) {\n                        /* This could happen if the user joins multiple channels where the other peer is also in. */\n                        return;\n                    }\n            \n                    var peer_connection = new RTCPeerConnection({\"iceServers\": ICE_SERVERS});\n                    peers[peer_id] = peer_connection;\n\n                    var dataChannel = peer_connection.createDataChannel('data');\n                    var syncDataChannel = peer_connection.createDataChannel('sync_data');\n                    //datachannel2: user data datachannel\n                    //data3: user data\n                    var dataChannel2 = peer_connection.createDataChannel('data3');\n\n                    dataChannel.binaryType = 'arraybuffer';\n                    syncDataChannel.binaryType = 'arraybuffer';\n                    dataChannel2.binaryType = 'arraybuffer';\n\n                    ywebrtc.dcs[peer_id] = dataChannel;\n                    ywebrtc.sdcs[peer_id] = syncDataChannel;\n                    ywebrtc.dcs2[peer_id] = dataChannel2;\n\n                    ywebrtc.userJoined(peer_id, 'master');\n\n\t                dataChannel.onmessage = receiveData(ywebrtc, peer_id);\n\t                syncDataChannel.onmessage = function (e) {\n\t                    ywebrtc.receivebuffer(peer_id, e.data);\n\t                };\n\t                dataChannel2.onmessage = receiveData2(ywebrtc, peer_id);;\n\n                    peer_connection.onicecandidate = function(event) {\n                        if (event.candidate) {\n                            signaling_socket.emit('relayICECandidate', {\n                                'peer_id': peer_id, \n                                'ice_candidate': {\n                                    'sdpMLineIndex': event.candidate.sdpMLineIndex,\n                                    'candidate': event.candidate.candidate\n                                }\n                            });\n                        }\n                    }\n            \n                    if (config.should_create_offer) {\n                        peer_connection.createOffer(\n                            function (local_description) { \n                                peer_connection.setLocalDescription(local_description,\n                                    function() { \n                                        signaling_socket.emit('relaySessionDescription', \n                                            {'peer_id': peer_id, 'session_description': local_description});\n                                    },\n                                    function() { Alert(\"Offer setLocalDescription failed!\"); }\n                                );\n                            },\n                            function (error) {\n                                console.log(\"Error sending offer: \", error);\n                            });\n                    }\n                });\n            \n            \n                /** \n                 * Peers exchange session descriptions which contains information\n                 * about their audio / video settings and that sort of stuff. First\n                 * the 'offerer' sends a description to the 'answerer' (with type\n                 * \"offer\"), then the answerer sends one back (with type \"answer\").  \n                 */\n                signaling_socket.on('sessionDescription', function(config) {\n                    var peer_id = config.peer_id;\n                    var peer = peers[peer_id];\n            \n                    peer.ondatachannel = function (event) {\n                        var dataChannel = event.channel;\n                        dataChannel.binaryType = 'arraybuffer';\n                        if (dataChannel.label == 'sync_data') {\n\t                        dataChannel.onmessage = receiveData(ywebrtc, peer_id);\n                        } else {\n                            dataChannel.onmessage = receiveData2(ywebrtc, peer_id);\n                        }\n                    };\n            \n                    var remote_description = config.session_description;\n            \n                    var desc = new RTCSessionDescription(remote_description);\n                    var stuff = peer.setRemoteDescription(desc, \n                        function() {\n                            if (remote_description.type == \"offer\") {\n                                peer.createAnswer(\n                                    function(local_description) {\n                                        peer.setLocalDescription(local_description,\n                                            function() { \n                                                signaling_socket.emit('relaySessionDescription', \n                                                    {'peer_id': peer_id, 'session_description': local_description});\n                                            },\n                                            function() { Alert(\"Answer setLocalDescription failed!\"); }\n                                        );\n                                    },\n                                    function(error) {\n                                        console.log(\"Error creating answer: \", error);\n                                    });\n                            }\n                        },\n                        function(error) {\n                            console.log(\"setRemoteDescription error: \", error);\n                        }\n                    );\n            \n                });\n            \n                signaling_socket.on('iceCandidate', function(config) {\n                    var peer = peers[config.peer_id];\n                    var ice_candidate = config.ice_candidate;\n                    peer.addIceCandidate(new RTCIceCandidate(ice_candidate));\n                });\n            \n            \n                signaling_socket.on('removePeer', function(config) {\n                    var peer_id = config.peer_id;\n                    ywebrtc.userLeft(peer_id);\n                    if (peer_id in peer_media_elements) {\n                        peer_media_elements[peer_id].remove();\n                    }\n                    if (peer_id in peers) {\n                        peers[peer_id].close();\n                    }\n            \n                    delete peers[peer_id];\n                    delete peer_media_elements[config.peer_id];\n                });\n            }\n            init(self);\n            /************************ end minimal_webrtc ****************************/\n        }\n\n        disconnect() {\n        }\n        destroy() {\n        }\n        reconnect() {\n        }\n\n        send(uid, message) {\n            console.log('$$$$$$$$$$$$$$$$ syncing...... $$$$$$$$$$$$$$$$$') ;\n            function send2(dataChannel, data2) {\n                if (dataChannel.readyState === 'open') {\n                    var CHUNK_LEN = 64000;\n                    var len = data2.byteLength;\n                    var n = len / CHUNK_LEN | 0;\n                    dataChannel.send(len);\n                    // split the photo and send in chunks of about 64KB\n                    for (var i = 0; i < n; i++) {\n                        var start = i * CHUNK_LEN,\n                            end = (i + 1) * CHUNK_LEN;\n                        dataChannel.send(data2.subarray(start, end));\n                    }\n                    // send the reminder, if any\n                    if (len % CHUNK_LEN) {\n                        dataChannel.send(data2.subarray(n * CHUNK_LEN));\n                    }\n                } else {\n                    setTimeout(send2, 500, dataChannel, data2);\n                }\n            }\n            send2(this.sdcs[uid], new Uint8Array(message));\n        }\n\n        broadcast(message) {\n            for (var peer_id in this.dcs) {\n                function send2(dataChannel, data2) {\n                    if (dataChannel.readyState === 'open') {\n                        var CHUNK_LEN = 64000;\n                        var len = data2.byteLength;\n                        var n = len / CHUNK_LEN | 0;\n                        dataChannel.send(len);\n                        // split the photo and send in chunks of about 64KB\n                        for (var i = 0; i < n; i++) {\n                            var start = i * CHUNK_LEN,\n                                end = (i + 1) * CHUNK_LEN;\n                            dataChannel.send(data2.subarray(start, end));\n                        }\n                        // send the reminder, if any\n                        if (len % CHUNK_LEN) {\n                            dataChannel.send(data2.subarray(n * CHUNK_LEN));\n                        }\n                    } else {\n                        console.log('Errrrrrrrrrrrrrrrrrrrrrrrrrrrrrr', peer_id);\n                    }\n                }\n                send2(this.dcs[peer_id], new Uint8Array(message));\n            }\n        }\n\n        isDisconnected() {\n            return this.socket.disconnected\n        }\n    }\n    Connector.io = io\n    Y['webrtc'] = Connector\n}\n\nif (typeof Y !== 'undefined') {\n    extend(Y) // eslint-disable-line\n}\n"],"names":[],"mappings":"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"}